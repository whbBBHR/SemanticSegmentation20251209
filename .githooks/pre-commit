#!/bin/bash
# Pre-commit hook to prevent committing sensitive files

# Colors for output
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Patterns to check for sensitive data
SENSITIVE_PATTERNS=(
    "credentials.json"
    "token.json"
    "*.key"
    "*.pem"
    ".env"
    "config.ini"
    "secrets.json"
    "password"
    "api_key"
    "secret_key"
    "private_key"
)

echo "üîç Checking for sensitive data..."

# Check for sensitive file patterns in staged files
for pattern in "${SENSITIVE_PATTERNS[@]}"; do
    if git diff --cached --name-only | grep -i "$pattern" > /dev/null; then
        echo -e "${RED}‚ùå ERROR: Attempting to commit sensitive file matching: $pattern${NC}"
        echo -e "${YELLOW}üí° Add this pattern to .gitignore and unstage the file${NC}"
        exit 1
    fi
done

# Check for sensitive strings in file contents
if git diff --cached | grep -iE "(api[_-]?key|secret[_-]?key|password|private[_-]?key|aws[_-]?access|bearer.{0,10}['\"]?[a-zA-Z0-9]{20,})" > /dev/null; then
    echo -e "${YELLOW}‚ö†Ô∏è  WARNING: Possible sensitive data detected in commit${NC}"
    echo -e "${YELLOW}Please review your changes carefully${NC}"
    read -p "Do you want to continue? (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        exit 1
    fi
fi

echo "‚úÖ Pre-commit checks passed"
exit 0
